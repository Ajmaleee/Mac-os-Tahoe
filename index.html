<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>macOS Tahoe Web Architecture</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;-webkit-user-select:none;user-select:none}
html,body{width:100%;height:100%;overflow:hidden}
:root{--blur:blur(30px);--dock-max-scale:1.9;--anim:cubic-bezier(.22,1,.36,1)}
body{background:linear-gradient(160deg,#5b7ca2,#1e2d44) center/cover no-repeat fixed;color:#111}
#desktop{position:relative;width:100%;height:100%}

.liquid-glass{background:linear-gradient(130deg,rgba(255,255,255,.45),rgba(255,255,255,.2));border:1px solid rgba(255,255,255,.42);box-shadow:inset 0 1px 1px rgba(255,255,255,.75),0 20px 40px rgba(0,0,0,.18);backdrop-filter:var(--blur) saturate(1.3)}

#menubar{position:absolute;inset:10px 12px auto 12px;height:32px;padding:0 12px;display:flex;align-items:center;justify-content:space-between;z-index:9999;border-radius:12px}
#menu-left,#menu-right{display:flex;align-items:center;gap:14px;font-size:13px}
#menu-left span,#menu-right span{cursor:pointer;opacity:.95}
#menu-left span:hover,#menu-right span:hover{opacity:1}
#appMenu{font-weight:500;letter-spacing:.1px}
#appleMenuBtn{font-weight:700}
.menu-wrap{position:relative}
.apple-dropdown{position:absolute;top:30px;left:0;width:260px;border-radius:12px;padding:8px;display:none;z-index:12000}
.apple-dropdown.active{display:block}
.menu-item{padding:7px 10px;border-radius:8px;font-size:13px;display:flex;justify-content:space-between;align-items:center;cursor:pointer}
.menu-item:hover{background:rgba(38,120,255,.22)}
.menu-sep{height:1px;background:rgba(0,0,0,.14);margin:6px 0}
.submenu{position:absolute;left:258px;top:112px;width:220px;display:none;padding:8px;border-radius:12px;max-height:220px;overflow:auto}
.submenu.active{display:block}

.window{position:absolute;width:900px;height:560px;border-radius:18px;overflow:hidden;display:flex;flex-direction:column;transform:scale(.93);opacity:0;transition:all .22s var(--anim)}
.window.open{transform:scale(1);opacity:1}
.window.maximized{inset:42px 0 0 0 !important;width:auto !important;height:auto !important;border-radius:0}
.titlebar{height:38px;display:flex;align-items:center;padding:0 12px;cursor:grab}
.controls{display:flex;gap:8px;margin-right:10px}
.control{width:12px;height:12px;border-radius:50%;cursor:pointer}
.close{background:#ff5f57}.min{background:#febc2e}.max{background:#28c840}
.window-title{font-size:13px;font-weight:600;opacity:.8}
.window-content{flex:1;padding:18px;overflow:auto;-webkit-user-select:text;user-select:text;background:rgba(255,255,255,.65)}

#desktop-icons{position:absolute;right:16px;top:66px;display:flex;flex-direction:column;gap:16px;z-index:2}
.desktop-item{width:90px;text-align:center;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,.7);cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:6px}
.desktop-item img{width:52px;height:52px;border-radius:12px;box-shadow:0 10px 20px rgba(0,0,0,.35)}
.desktop-item:hover{transform:translateY(-2px)}

#dock{position:absolute;left:50%;bottom:14px;transform:translateX(-50%);height:88px;padding:12px 18px;display:flex;align-items:flex-end;gap:8px;z-index:9998;border-radius:24px}
.dock-item{position:relative;width:56px;height:56px;display:flex;align-items:flex-end;justify-content:center;transition:transform .14s var(--anim)}
.dock-item-inner{width:56px;height:56px;border-radius:16px;overflow:hidden;box-shadow:0 8px 18px rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.42);transform-origin:center bottom;transition:transform .14s var(--anim)}
.dock-item img{width:100%;height:100%;display:block}
.dock-item::after{content:attr(data-name);position:absolute;bottom:66px;left:50%;transform:translateX(-50%) translateY(4px);padding:4px 8px;border-radius:8px;font-size:11px;background:rgba(0,0,0,.65);color:#fff;opacity:0;pointer-events:none;transition:all .14s}
.dock-item.hovered::after{opacity:1;transform:translateX(-50%) translateY(0)}
.dock-item.hovered{z-index:20}
.dock-item.running::before{content:'';position:absolute;bottom:-2px;width:6px;height:6px;border-radius:50%;background:rgba(0,0,0,.8)}

#mission{position:absolute;inset:0;background:rgba(0,0,0,.35);backdrop-filter:blur(12px);display:none;z-index:9997;padding:70px;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:22px}
#mission.active{display:grid}
.mini{height:180px;border-radius:14px}

.system-overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;flex-direction:column;z-index:13000;background:rgba(6,12,22,.78);color:#fff;backdrop-filter:blur(16px)}
.system-overlay.active{display:flex}
.overlay-card{padding:22px 26px;border-radius:16px;text-align:center;min-width:280px}
.overlay-card h2{margin-bottom:8px}
.overlay-card p{opacity:.9;margin-bottom:12px}
.overlay-card button{padding:8px 14px;border-radius:8px;border:none;background:#2f7dff;color:#fff;cursor:pointer}

input,button{font:inherit}
</style>
</head>
<body>
<div id="desktop"></div>
<div id="mission"></div>
<div id="sleepOverlay" class="system-overlay"><div class="overlay-card liquid-glass"><h2>Sleeping…</h2><p>Move mouse or click to wake.</p></div></div>
<div id="lockOverlay" class="system-overlay"><div class="overlay-card liquid-glass"><h2>Locked</h2><p>Click Unlock to continue.</p><button id="unlockBtn">Unlock</button></div></div>
<div id="shutdownOverlay" class="system-overlay"><div class="overlay-card liquid-glass"><h2>Shut Down</h2><p>Mac is powered off.</p><button id="powerOnBtn">Power On</button></div></div>

<div id="menubar" class="liquid-glass">
  <div id="menu-left">
    <div class="menu-wrap">
      <span id="appleMenuBtn"></span>
      <div id="appleDropdown" class="apple-dropdown liquid-glass">
        <div class="menu-item" data-action="about">About This Mac</div>
        <div class="menu-item" data-action="settings">System Settings…</div>
        <div class="menu-item" data-action="appstore">App Store…</div>
        <div class="menu-sep"></div>
        <div class="menu-item" data-action="recent">Recent Items <span>›</span></div>
        <div class="menu-item" data-action="forcequit">Force Quit…</div>
        <div class="menu-sep"></div>
        <div class="menu-item" data-action="sleep">Sleep</div>
        <div class="menu-item" data-action="restart">Restart…</div>
        <div class="menu-item" data-action="shutdown">Shut Down…</div>
        <div class="menu-sep"></div>
        <div class="menu-item" data-action="lock">Lock Screen</div>
        <div class="menu-item" data-action="logout">Log Out</div>
      </div>
      <div id="recentSubmenu" class="submenu liquid-glass"></div>
    </div>
    <span id="activeApp">Finder</span>
    <span id="appMenu">File Edit View Go Window Help</span>
  </div>
  <div id="menu-right">
    <span id="missionBtn">Mission Control</span>
    <span id="clock"></span>
  </div>
</div>

<div id="desktop-icons"></div>
<div id="dock" class="liquid-glass"></div>

<script>
class WindowManager{constructor(){this.z=2}focus(win){win.style.zIndex=this.z++}}
const WM=new WindowManager()
const desktop=document.getElementById('desktop')
const dock=document.getElementById('dock')
const desktopIcons=document.getElementById('desktop-icons')
const appleDropdown=document.getElementById('appleDropdown')
const recentSubmenu=document.getElementById('recentSubmenu')
const openWindows=[]
const recentItems=[]
let activeWindowRef=null

const menus={Finder:'File Edit View Go Window Help',Safari:'File Edit View History Bookmarks Develop Window Help',Discord:'File Edit View Window Help',Spotify:'Spotify File Edit View Playback Window Help',Music:'File Edit Song Playback Controls Window Help',Terminal:'Shell Edit View Window Help',Notes:'File Edit View Note Format Window Help',Mail:'File Edit View Mailbox Message Format Window Help',Settings:'File Edit View Window Help','App Store':'Store Edit View Window Help'}

const apps=[
{name:'Finder',icons:['https://img.icons8.com/color/96/finder.png','https://img.icons8.com/fluency/96/finder.png']},
{name:'Safari',icons:['https://img.icons8.com/color/96/safari--v1.png','https://img.icons8.com/fluency/96/safari--v1.png']},
{name:'Mail',icons:['https://img.icons8.com/color/96/apple-mail.png','https://img.icons8.com/fluency/96/apple-mail.png']},
{name:'Notes',icons:['https://img.icons8.com/color/96/apple-notes.png','https://img.icons8.com/fluency/96/apple-notes.png']},
{name:'Music',icons:['https://img.icons8.com/color/96/apple-music.png','https://img.icons8.com/fluency/96/apple-music.png']},
{name:'App Store',icons:['https://img.icons8.com/color/96/mac-os.png','https://img.icons8.com/fluency/96/mac-os.png']},
{name:'Calendar',icons:['https://img.icons8.com/color/96/calendar--v1.png','https://img.icons8.com/fluency/96/calendar--v1.png']},
{name:'Photos',icons:['https://img.icons8.com/color/96/apple-photos.png','https://img.icons8.com/fluency/96/apple-photos.png']},
{name:'Messages',icons:['https://img.icons8.com/color/96/messages-mac.png','https://img.icons8.com/fluency/96/messages-mac.png']},
{name:'Terminal',icons:['https://img.icons8.com/color/96/console.png','https://img.icons8.com/fluency/96/console.png']},
{name:'Discord',icons:['https://upload.wikimedia.org/wikipedia/commons/a/a7/Discord_icon.svg']},
{name:'Spotify',icons:['https://upload.wikimedia.org/wikipedia/commons/8/84/Spotify_icon.svg']},
{name:'Settings',icons:['https://img.icons8.com/color/96/settings--v1.png','https://img.icons8.com/fluency/96/settings--v1.png']}
]
const desktopShortcuts=[apps[0],apps[1],apps[9]]

const fallbackIcon=(name)=>`data:image/svg+xml;utf8,${encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 96 96'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop stop-color='#d7e3f7'/><stop offset='1' stop-color='#8ea4c9'/></linearGradient></defs><rect x='8' y='8' width='80' height='80' rx='18' fill='url(#g)'/><text x='48' y='56' text-anchor='middle' font-family='Inter' font-size='16' fill='#223'>${name.slice(0,1)}</text></svg>`)}`

function setIconWithFallback(img,app){const sources=[...(app.icons||[]),fallbackIcon(app.name)];let i=0;const load=()=>{img.src=sources[i]};img.onerror=()=>{i=Math.min(i+1,sources.length-1);load()};load()}

function applyTahoeBackground(){const primary='https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=2200';const backup='https://images.unsplash.com/photo-1682686581223-689c34afb6ef?q=80&w=2300';const test=new Image();test.onload=()=>{document.body.style.background=`url('${primary}') center/cover no-repeat fixed`};test.onerror=()=>{document.body.style.background=`url('${backup}') center/cover no-repeat fixed`};test.src=primary}

function addRecentItem(name){
  recentItems.unshift({name,time:new Date()})
  const unique=[]
  recentItems.forEach(item=>{if(!unique.find(u=>u.name===item.name))unique.push(item)})
  recentItems.length=0
  unique.slice(0,8).forEach(i=>recentItems.push(i))
}

function renderRecentSubmenu(){
  recentSubmenu.innerHTML=''
  if(!recentItems.length){recentSubmenu.innerHTML='<div class="menu-item">No Recent Items</div>';return}
  recentItems.forEach(item=>{
    const row=document.createElement('div')
    row.className='menu-item'
    row.textContent=item.name
    row.onclick=()=>{openApp(item.name,[...dock.children].find(el=>el.dataset.name===item.name));closeAppleMenu()}
    recentSubmenu.appendChild(row)
  })
}

function toggleAppleMenu(show){
  const active=show ?? !appleDropdown.classList.contains('active')
  appleDropdown.classList.toggle('active',active)
  if(!active) recentSubmenu.classList.remove('active')
}

function closeAppleMenu(){appleDropdown.classList.remove('active');recentSubmenu.classList.remove('active')}

function createDock(){
  apps.forEach((app,index)=>{
    const item=document.createElement('div');item.className='dock-item';item.dataset.index=index;item.dataset.name=app.name
    const inner=document.createElement('div');inner.className='dock-item-inner'
    const img=document.createElement('img');img.alt=app.name;img.loading='eager';setIconWithFallback(img,app)
    inner.appendChild(img);item.appendChild(inner)
    item.addEventListener('click',()=>openApp(app.name,item))
    item.addEventListener('mouseenter',()=>item.classList.add('hovered'))
    item.addEventListener('mouseleave',()=>item.classList.remove('hovered'))
    dock.appendChild(item)
  })
}

function createDesktopIcons(){
  desktopShortcuts.forEach(app=>{
    const item=document.createElement('div');item.className='desktop-item'
    const img=document.createElement('img');img.alt=app.name;setIconWithFallback(img,app)
    const label=document.createElement('div');label.textContent=app.name
    item.append(img,label)
    item.addEventListener('dblclick',()=>openApp(app.name,[...dock.children].find(el=>el.dataset.name===app.name)))
    desktopIcons.appendChild(item)
  })
}

function setMenu(name){document.getElementById('activeApp').textContent=name;document.getElementById('appMenu').textContent=menus[name]||'File Edit View Window Help'}

function openApp(name,dockItem){
  const win=document.createElement('div')
  win.className='window liquid-glass'
  win.dataset.app=name
  win.style.left=(130+Math.random()*250)+'px'
  win.style.top=(84+Math.random()*120)+'px'
  WM.focus(win)
  if(dockItem)dockItem.classList.add('running')

  const bar=document.createElement('div');bar.className='titlebar liquid-glass'
  const controls=document.createElement('div');controls.className='controls'
  controls.innerHTML='<div class="control close"></div><div class="control min"></div><div class="control max"></div>'
  controls.children[0].onclick=(e)=>{e.stopPropagation();closeWindow(win,dockItem)}
  controls.children[1].onclick=(e)=>{e.stopPropagation();minimizeWindow(win,dockItem)}
  controls.children[2].onclick=(e)=>{e.stopPropagation();win.classList.toggle('maximized')}
  const t=document.createElement('div');t.className='window-title';t.textContent=name
  bar.append(controls,t)

  const content=document.createElement('div');content.className='window-content';content.innerHTML=appUI(name)
  win.append(bar,content);desktop.appendChild(win);makeDraggable(win,bar)

  openWindows.push({name,win,dockItem})
  activeWindowRef=win
  addRecentItem(name)
  win.addEventListener('mousedown',()=>{WM.focus(win);setMenu(name);activeWindowRef=win})
  requestAnimationFrame(()=>win.classList.add('open'))
  setMenu(name)
}

function forgetWindow(win){
  const idx=openWindows.findIndex(w=>w.win===win)
  if(idx>-1)openWindows.splice(idx,1)
  if(activeWindowRef===win)activeWindowRef=openWindows.length?openWindows[openWindows.length-1].win:null
}

function closeWindow(win,dockItem){
  win.style.opacity='0';win.style.transform='scale(.9)'
  setTimeout(()=>{win.remove();if(dockItem)dockItem.classList.remove('running');forgetWindow(win)},180)
}

function minimizeWindow(win,dockItem){
  if(!dockItem)return closeWindow(win,dockItem)
  const r=win.getBoundingClientRect(),d=dockItem.getBoundingClientRect();const c=win.cloneNode(true)
  c.style.position='fixed';c.style.margin='0';c.style.left=r.left+'px';c.style.top=r.top+'px';c.style.width=r.width+'px';c.style.height=r.height+'px';c.style.transition='all .35s var(--anim)';c.style.zIndex=10000
  document.body.appendChild(c);win.remove();forgetWindow(win)
  requestAnimationFrame(()=>{c.style.left=d.left+'px';c.style.top=d.top+'px';c.style.width='56px';c.style.height='56px';c.style.opacity='0'})
  setTimeout(()=>c.remove(),360)
}

function makeDraggable(win,handle){let dragging=false,ox=0,oy=0;handle.addEventListener('mousedown',e=>{if(e.target.classList.contains('control'))return;dragging=true;ox=e.clientX-win.offsetLeft;oy=e.clientY-win.offsetTop});document.addEventListener('mousemove',e=>{if(!dragging||win.classList.contains('maximized'))return;win.style.left=e.clientX-ox+'px';win.style.top=e.clientY-oy+'px'});document.addEventListener('mouseup',()=>dragging=false)}

function appUI(name){if(name==='Finder')return `<h2>Welcome to macOS Tahoe</h2><p style="margin-top:8px;line-height:1.5">Liquid-glass shell enabled, responsive dock physics active, dynamic app menus running.</p>`;if(name==='Safari')return `<h2>Safari</h2><input style="width:100%;padding:10px;border-radius:10px;border:1px solid #c7ccd5" placeholder="Search or enter website name">`;if(name==='Music' || name==='Spotify')return `<h2>${name}</h2><div style="height:220px;border-radius:14px;background:linear-gradient(140deg,#fe7bbd,#5d66ff)"></div>`;if(name==='Discord')return `<h2>Discord</h2><div style="padding:12px;border-radius:12px;background:#5865f2;color:#fff;width:max-content">Server List</div>`;if(name==='Settings')return `<h2>System Settings</h2><p>Display, Sound, Network and Privacy controls.</p>`;if(name==='App Store')return `<h2>App Store</h2><p>Discover and install apps.</p>`;return `<h2>${name}</h2><p style="margin-top:8px">App simulation window.</p>`}

function setupDockPhysics(){dock.addEventListener('mousemove',e=>{[...dock.querySelectorAll('.dock-item')].forEach(item=>{const inner=item.querySelector('.dock-item-inner');const rect=item.getBoundingClientRect();const center=rect.left+rect.width/2;const dist=Math.abs(e.clientX-center);const influence=Math.max(0,1-dist/130);const scale=1+(parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--dock-max-scale'))-1)*Math.pow(influence,1.5);inner.style.transform=`scale(${scale.toFixed(3)})`})});dock.addEventListener('mouseleave',()=>{dock.querySelectorAll('.dock-item').forEach(item=>item.querySelector('.dock-item-inner').style.transform='scale(1)')})}

function setupAmbientInteractivity(){document.addEventListener('mousemove',e=>{const x=(e.clientX/window.innerWidth-.5)*10;const y=(e.clientY/window.innerHeight-.5)*10;document.getElementById('menubar').style.transform=`translate(${x*0.12}px,${y*0.08}px)`;dock.style.transform=`translateX(calc(-50% + ${x*0.2}px)) translateY(${Math.abs(y)*0.05}px)`})}

function toggleMission(){const m=document.getElementById('mission');m.classList.toggle('active');m.innerHTML='';if(!m.classList.contains('active')) return;document.querySelectorAll('.window').forEach(()=>{const mini=document.createElement('div');mini.className='mini liquid-glass';m.appendChild(mini)})}

function aboutThisMac(){alert('About This Mac\n\nmacOS Tahoe Web\nVersion 1.0\nApple Silicon (simulated)\n16 GB Memory (simulated)')}
function openSystemSettings(){openApp('Settings',[...dock.children].find(el=>el.dataset.name==='Settings'))}
function openAppStore(){openApp('App Store',[...dock.children].find(el=>el.dataset.name==='App Store'))}
function forceQuitActive(){
  if(!activeWindowRef){alert('No active app to force quit.');return}
  const match=openWindows.find(w=>w.win===activeWindowRef)
  if(match) closeWindow(match.win,match.dockItem)
}
function sleepMac(){const s=document.getElementById('sleepOverlay');s.classList.add('active');const wake=()=>{s.classList.remove('active');document.removeEventListener('mousemove',wake);s.removeEventListener('click',wake)};setTimeout(()=>{document.addEventListener('mousemove',wake,{once:true});s.addEventListener('click',wake,{once:true})},120)}
function restartMac(){location.reload()}
function shutdownMac(){document.getElementById('shutdownOverlay').classList.add('active')}
function lockScreen(){document.getElementById('lockOverlay').classList.add('active')}
function logOut(){document.querySelectorAll('.window').forEach(win=>win.remove());openWindows.length=0;document.querySelectorAll('.dock-item').forEach(i=>i.classList.remove('running'));setMenu('Finder');alert('Logged out successfully.')}

function setupAppleMenu(){
  document.getElementById('appleMenuBtn').onclick=(e)=>{e.stopPropagation();toggleAppleMenu()}
  appleDropdown.addEventListener('click',e=>{
    const item=e.target.closest('.menu-item')
    if(!item)return
    const action=item.dataset.action
    if(action==='recent'){renderRecentSubmenu();recentSubmenu.classList.toggle('active');return}
    const handlers={about:aboutThisMac,settings:openSystemSettings,appstore:openAppStore,forcequit:forceQuitActive,sleep:sleepMac,restart:restartMac,shutdown:shutdownMac,lock:lockScreen,logout:logOut}
    if(handlers[action]) handlers[action]()
    closeAppleMenu()
  })
  document.addEventListener('click',(e)=>{if(!e.target.closest('.menu-wrap'))closeAppleMenu()})
  document.getElementById('unlockBtn').onclick=()=>document.getElementById('lockOverlay').classList.remove('active')
  document.getElementById('powerOnBtn').onclick=()=>document.getElementById('shutdownOverlay').classList.remove('active')
}

setInterval(()=>document.getElementById('clock').textContent=new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}),1000)
document.getElementById('missionBtn').onclick=toggleMission

applyTahoeBackground();createDock();createDesktopIcons();setupDockPhysics();setupAmbientInteractivity();setupAppleMenu();
window.addEventListener('load',()=>openApp('Finder',[...dock.children][0]))
</script>
</body>
</html>
